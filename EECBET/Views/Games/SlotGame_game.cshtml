@{
    Layout = "~/Views/Shared/_SlotLayout.cshtml";
    ViewBag.Title = " SlotGame_game";
    var isAuthenticated = Context.Session.GetInt32("MemberId") != null;
}
<link rel="stylesheet" href="~/css/slotgameBase.css" asp-append-version="true" />
@model EECBET.Models.GameListViewModel

<style>
    /* ğŸ©¶ é»‘å¹•é®ç½© */
    .login-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.75);
        z-index: 9999;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
    }

    .login-overlay.show {
        opacity: 1;
        pointer-events: auto;
    }
</style>


<div class="game-container">

    <button class="closeBtn" onclick="closeGame()">X</button>

    <div class="gameIframe" id="slotplaybtn">
        <iframe frameborder="0" src="@Model.GameLink" allowfullscreen="true">
        </iframe>
    </div>

</div>

<!-- é»‘å¹•å±¤ -->
<div id="loginOverlay" class="login-overlay"></div>

<script>
const isAuthenticated = @(isAuthenticated.ToString().ToLower());
const gameId = @Model.GameID;

function closeGame() {
    window.history.back();
}

window.addEventListener('DOMContentLoaded', () => {
    if (!isAuthenticated) {
        const overlay = document.getElementById('loginOverlay');
        overlay.classList.add('show');
        setTimeout(() => {
            alert('è«‹å…ˆç™»å…¥æ‰èƒ½é€²è¡ŒæŠ•æ³¨');
            window.location.href = '/Member/Login';
        }, 300);
        return;
    }

    // âœ… å·²ç™»å…¥ â†’ ç”¨ GET å‚³éŠæˆ²IDï¼Œç´€éŒ„é€²å…¥
    fetch(`/Member/RecordGamePlay?id=${gameId}`)
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                console.log('âœ… å·²è¨˜éŒ„é€²å…¥éŠæˆ²ï¼š', data);
            } else {
                console.warn('âš ï¸ è¨˜éŒ„å¤±æ•—ï¼š', data.message);
            }
        })
        .catch(err => console.error('âŒ å‘¼å« RecordGamePlay ç™¼ç”ŸéŒ¯èª¤:', err));
});
</script>